# R2 å­˜å‚¨è¿ç§»æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»º R2 å­˜å‚¨é€‚é…å™¨
- âœ… åˆ›å»ºäº† `src/lib/r2-storage.ts`
- âœ… å®ç°äº†å®Œæ•´çš„ R2 å­˜å‚¨æ¥å£
- âœ… æ”¯æŒè‡ªåŠ¨å›é€€åˆ°æ–‡ä»¶ç³»ç»Ÿï¼ˆæœ¬åœ°å¼€å‘ï¼‰

### 2. è¿ç§»æ‰€æœ‰ API åˆ° R2
- âœ… `src/app/api/posts/route.ts` - æ–‡ç«  CRUD
- âœ… `src/app/api/settings/route.ts` - è®¾ç½®ç®¡ç†
- âœ… `src/app/api/messages/route.ts` - ç•™è¨€ç®¡ç†
- âœ… `src/app/api/about/route.ts` - å…³äºé¡µé¢ç®¡ç†
- âœ… `src/app/api/subscribe/route.ts` - è®¢é˜…ç®¡ç†
- âœ… `src/app/api/upload/route.ts` - æ–‡ä»¶ä¸Šä¼ 
- âœ… `src/app/uploads/[...path]/route.ts` - æ–‡ä»¶è®¿é—®

### 3. é…ç½®æ›´æ–°
- âœ… æ›´æ–°äº† `wrangler.toml` é…ç½® R2 bucket
- âœ… æ›´æ–°äº† `package.json` æ·»åŠ éƒ¨ç½²è„šæœ¬
- âœ… ä¿®å¤äº†éƒ¨ç½²å‘½ä»¤ï¼ˆä½¿ç”¨ `pages deploy`ï¼‰

## ğŸ¯ æ”¯æŒçš„åŠŸèƒ½

### å®Œæ•´çš„ CRUD æ“ä½œ

#### æ–‡ç« ç®¡ç† (`/api/posts`)
- âœ… **GET** - æŸ¥è¯¢æ–‡ç« åˆ—è¡¨/è¯¦æƒ…
- âœ… **POST** - åˆ›å»ºæ–°æ–‡ç« 
- âœ… **PUT** - æ›´æ–°æ–‡ç« 
- âœ… **DELETE** - åˆ é™¤æ–‡ç« 

#### ç•™è¨€ç®¡ç† (`/api/messages`)
- âœ… **GET** - æŸ¥è¯¢ç•™è¨€åˆ—è¡¨
- âœ… **POST** - åˆ›å»ºæ–°ç•™è¨€
- âœ… **DELETE** - åˆ é™¤ç•™è¨€

#### è®¾ç½®ç®¡ç† (`/api/settings`)
- âœ… **GET** - è·å–ç«™ç‚¹è®¾ç½®
- âœ… **POST** - æ›´æ–°ç«™ç‚¹è®¾ç½®

#### å…³äºé¡µé¢ (`/api/about`)
- âœ… **GET** - è·å–å…³äºé¡µé¢æ•°æ®
- âœ… **PUT** - æ›´æ–°å…³äºé¡µé¢æ•°æ®
- âœ… **POST** - æ·»åŠ /æ›´æ–°æ—¶é—´çº¿ã€é¡¹ç›®
- âœ… **DELETE** - åˆ é™¤æ—¶é—´çº¿ã€é¡¹ç›®

#### è®¢é˜…ç®¡ç† (`/api/subscribe`)
- âœ… **GET** - æŸ¥è¯¢è®¢é˜…è€…åˆ—è¡¨
- âœ… **POST** - æ·»åŠ æ–°è®¢é˜…è€…
- âœ… **DELETE** - åˆ é™¤è®¢é˜…è€…

#### æ–‡ä»¶ç®¡ç†
- âœ… **POST /api/upload** - ä¸Šä¼ æ–‡ä»¶åˆ° R2
- âœ… **GET /uploads/[...path]** - ä» R2 è¯»å–æ–‡ä»¶

## ğŸ“‹ éƒ¨ç½²å‰å¿…é¡»å®Œæˆçš„æ­¥éª¤

### 1. åœ¨ Cloudflare Dashboard ä¸­åˆ›å»º R2 Bucket

1. ç™»å½• Cloudflare Dashboard
2. è¿›å…¥ **R2** éƒ¨åˆ†
3. ç‚¹å‡» **Create bucket**
4. åˆ›å»º bucketï¼š`blog-storage`

### 2. é…ç½® Cloudflare Pages Functions

1. è¿›å…¥ä½ çš„ Pages é¡¹ç›®
2. è¿›å…¥ **Settings** > **Functions**
3. åœ¨ **R2 Bucket Bindings** ä¸­æ·»åŠ ï¼š
   - **Variable name**: `BLOG_STORAGE`
   - **R2 bucket**: `blog-storage`

### 3. æ›´æ–°éƒ¨ç½²å‘½ä»¤

åœ¨ Cloudflare Pages çš„æ„å»ºè®¾ç½®ä¸­ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„éƒ¨ç½²å‘½ä»¤ï¼š

**é‡è¦**ï¼šå¦‚æœä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²ï¼ˆGitHub é›†æˆï¼‰ï¼Œéœ€è¦åœ¨ Cloudflare Dashboard ä¸­é…ç½®ï¼š
- **Build command**: `npm run build`
- **Build output directory**: `.next`
- **Root directory**: `/`

å¦‚æœä½¿ç”¨æ‰‹åŠ¨éƒ¨ç½²ï¼š
```bash
npm run pages:deploy
```

## ğŸ”§ æŠ€æœ¯å®ç°

### R2 å­˜å‚¨é€‚é…å™¨ç‰¹æ€§

1. **è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹**
   - ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ R2 å­˜å‚¨
   - æœ¬åœ°å¼€å‘ï¼šè‡ªåŠ¨å›é€€åˆ°æ–‡ä»¶ç³»ç»Ÿ

2. **æ•°æ®æ–‡ä»¶é”®å**
   - `about.json` - å…³äºé¡µé¢æ•°æ®
   - `posts.json` - æ–‡ç« æ•°æ®
   - `messages.json` - ç•™è¨€æ•°æ®
   - `settings.json` - è®¾ç½®æ•°æ®
   - `subscribers.json` - è®¢é˜…è€…æ•°æ®
   - `uploads/` - ä¸Šä¼ çš„æ–‡ä»¶

3. **é”™è¯¯å¤„ç†**
   - è‡ªåŠ¨å›é€€æœºåˆ¶
   - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ğŸš€ éƒ¨ç½²æµç¨‹

### æ–¹å¼ 1: ä½¿ç”¨ Cloudflare Dashboardï¼ˆæ¨èï¼‰

1. è¿æ¥ GitHub ä»“åº“
2. é…ç½®æ„å»ºè®¾ç½®
3. ç»‘å®š R2 bucket
4. è‡ªåŠ¨éƒ¨ç½²

### æ–¹å¼ 2: ä½¿ç”¨ Wrangler CLI

```bash
# æ„å»ºé¡¹ç›®
npm run build

# éƒ¨ç½²åˆ° Cloudflare Pages
npx wrangler pages deploy .next --project-name=ainova-life
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è¿ç§»**ï¼šå¦‚æœéœ€è¦è¿ç§»ç°æœ‰æ•°æ®ï¼Œéœ€è¦æ‰‹åŠ¨ä¸Šä¼  JSON æ–‡ä»¶åˆ° R2 bucket
2. **æ–‡ä»¶è®¿é—®**ï¼šä¸Šä¼ çš„æ–‡ä»¶é€šè¿‡ `/uploads/[...path]` API è·¯ç”±è®¿é—®
3. **ç¯å¢ƒå˜é‡**ï¼šR2 bucket é€šè¿‡ Cloudflare Pages Functions ç»‘å®šï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… åˆ›å»º R2 bucket
2. âœ… é…ç½® Pages Functions ç»‘å®š
3. âœ… éƒ¨ç½²é¡¹ç›®
4. âœ… æµ‹è¯• CRUD åŠŸèƒ½

éƒ¨ç½²æˆåŠŸåï¼Œä½ çš„åšå®¢å°†å®Œå…¨æ”¯æŒåœ¨ Cloudflare ä¸Šçš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼

